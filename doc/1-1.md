# Phase 1 Implementation Details (Steps 1-3)

## Detailed Implementation Plan for Phase 1 (Steps 1-3)

### Step 1: Initial Setup of Electron + React + TypeScript

#### 1.1 Initialize npm project
```bash
npm init -y
```

#### 1.2 Install core dependencies
```bash
# Electron and types
npm install --save-dev electron electron-builder @types/node

# React and related
npm install react react-dom
npm install --save-dev @types/react @types/react-dom

# TypeScript and build tools
npm install --save-dev typescript ts-node tsconfig-paths
npm install --save-dev webpack webpack-cli webpack-dev-server
npm install --save-dev html-webpack-plugin copy-webpack-plugin
npm install --save-dev ts-loader style-loader css-loader

# Development tools
npm install --save-dev eslint prettier
npm install --save-dev @typescript-eslint/parser @typescript-eslint/eslint-plugin
npm install --save-dev eslint-config-prettier eslint-plugin-react eslint-plugin-react-hooks

# Electron development
npm install --save-dev electron-reload concurrently
```

#### 1.3 Create TypeScript configuration files

**tsconfig.json** (root):
```json
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "commonjs",
    "lib": ["ES2020", "DOM"],
    "jsx": "react-jsx",
    "outDir": "./dist",
    "rootDir": "./src",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "resolveJsonModule": true,
    "moduleResolution": "node",
    "baseUrl": "./",
    "paths": {
      "@shared/*": ["src/shared/*"],
      "@main/*": ["src/main/*"],
      "@renderer/*": ["src/renderer/*"]
    }
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules", "dist", "library"]
}
```

#### 1.4 Create webpack configuration

**webpack.config.js**:
```javascript
const path = require('path');
const HtmlWebpackPlugin = require('html-webpack-plugin');
const CopyWebpackPlugin = require('copy-webpack-plugin');

module.exports = {
  mode: process.env.NODE_ENV || 'development',
  entry: './src/renderer/index.tsx',
  target: 'electron-renderer',
  devtool: 'source-map',
  module: {
    rules: [
      {
        test: /\.tsx?$/,
        use: 'ts-loader',
        exclude: /node_modules/,
      },
      {
        test: /\.css$/,
        use: ['style-loader', 'css-loader'],
      },
    ],
  },
  resolve: {
    extensions: ['.tsx', '.ts', '.js'],
    alias: {
      '@renderer': path.resolve(__dirname, 'src/renderer'),
      '@shared': path.resolve(__dirname, 'src/shared'),
    },
  },
  output: {
    filename: 'bundle.js',
    path: path.resolve(__dirname, 'dist/renderer'),
  },
  plugins: [
    new HtmlWebpackPlugin({
      template: './public/index.html',
    }),
  ],
};
```

### Step 2: Create Basic Window and Menus

#### 2.1 Main process entry point

**src/main/index.ts**:
```typescript
import { app, BrowserWindow, Menu, dialog, ipcMain } from 'electron';
import * as path from 'path';
import { createMainMenu } from './menu';
import { setupIpcHandlers } from './ipc';

let mainWindow: BrowserWindow | null = null;

function createWindow(): void {
  mainWindow = new BrowserWindow({
    width: 1400,
    height: 900,
    minWidth: 800,
    minHeight: 600,
    webPreferences: {
      nodeIntegration: false,
      contextIsolation: true,
      preload: path.join(__dirname, 'preload.js')
    },
    icon: path.join(__dirname, '../../public/icon.png')
  });

  // Load the app
  if (process.env.NODE_ENV === 'development') {
    mainWindow.loadURL('http://localhost:8080');
    mainWindow.webContents.openDevTools();
  } else {
    mainWindow.loadFile(path.join(__dirname, '../renderer/index.html'));
  }

  // Set up menu
  const menu = createMainMenu(mainWindow);
  Menu.setApplicationMenu(menu);

  mainWindow.on('closed', () => {
    mainWindow = null;
  });
}

app.whenReady().then(() => {
  createWindow();
  setupIpcHandlers();
});

app.on('window-all-closed', () => {
  if (process.platform !== 'darwin') {
    app.quit();
  }
});

app.on('activate', () => {
  if (mainWindow === null) {
    createWindow();
  }
});
```

#### 2.2 Menu structure

**src/main/menu.ts**:
```typescript
import { Menu, MenuItemConstructorOptions, BrowserWindow, dialog, app } from 'electron';

export function createMainMenu(window: BrowserWindow): Menu {
  const template: MenuItemConstructorOptions[] = [
    {
      label: 'File',
      submenu: [
        {
          label: 'New Download',
          accelerator: 'CmdOrCtrl+N',
          click: () => {
            window.webContents.send('menu-action', 'new-download');
          }
        },
        {
          label: 'Import Folder',
          click: () => {
            window.webContents.send('menu-action', 'import-folder');
          }
        },
        { type: 'separator' },
        {
          label: 'Exit',
          accelerator: process.platform === 'darwin' ? 'Cmd+Q' : 'Ctrl+Q',
          click: () => {
            app.quit();
          }
        }
      ]
    },
    {
      label: 'Edit',
      submenu: [
        { label: 'Undo', accelerator: 'CmdOrCtrl+Z', role: 'undo' },
        { label: 'Redo', accelerator: 'CmdOrCtrl+Y', role: 'redo' },
        { type: 'separator' },
        { label: 'Cut', accelerator: 'CmdOrCtrl+X', role: 'cut' },
        { label: 'Copy', accelerator: 'CmdOrCtrl+C', role: 'copy' },
        { label: 'Paste', accelerator: 'CmdOrCtrl+V', role: 'paste' }
      ]
    },
    {
      label: 'View',
      submenu: [
        {
          label: 'Grid View',
          type: 'radio',
          checked: true,
          click: () => {
            window.webContents.send('menu-action', 'view-grid');
          }
        },
        {
          label: 'List View',
          type: 'radio',
          click: () => {
            window.webContents.send('menu-action', 'view-list');
          }
        },
        { type: 'separator' },
        {
          label: 'Toggle Fullscreen',
          accelerator: 'F11',
          click: () => {
            window.setFullScreen(!window.isFullScreen());
          }
        }
      ]
    },
    {
      label: 'Library',
      submenu: [
        {
          label: 'Manage Tags',
          click: () => {
            window.webContents.send('menu-action', 'manage-tags');
          }
        },
        {
          label: 'Search',
          accelerator: 'CmdOrCtrl+F',
          click: () => {
            window.webContents.send('menu-action', 'search');
          }
        },
        { type: 'separator' },
        {
          label: 'Refresh Library',
          accelerator: 'F5',
          click: () => {
            window.webContents.send('menu-action', 'refresh-library');
          }
        }
      ]
    }
  ];

  return Menu.buildFromTemplate(template);
}
```

#### 2.3 Preload script for secure IPC

**src/main/preload.ts**:
```typescript
import { contextBridge, ipcRenderer } from 'electron';

contextBridge.exposeInMainWorld('electronAPI', {
  // Menu actions
  onMenuAction: (callback: (action: string) => void) => {
    ipcRenderer.on('menu-action', (_, action) => callback(action));
  },

  // File operations
  selectDirectory: () => ipcRenderer.invoke('select-directory'),
  readLibrary: () => ipcRenderer.invoke('read-library'),
  saveMetadata: (workId: string, metadata: any) =>
    ipcRenderer.invoke('save-metadata', workId, metadata),

  // Crawler operations
  startCrawling: (url: string) => ipcRenderer.invoke('start-crawling', url),
  cancelCrawling: () => ipcRenderer.invoke('cancel-crawling'),
  onCrawlingProgress: (callback: (progress: any) => void) => {
    ipcRenderer.on('crawling-progress', (_, progress) => callback(progress));
  }
});
```

### Step 3: Build Project Structure

#### 3.1 Complete directory structure creation

```
image-viewer/
├── src/
│   ├── main/
│   │   ├── index.ts          # Entry point
│   │   ├── menu.ts           # Menu configuration
│   │   ├── preload.ts        # Preload script
│   │   ├── ipc.ts            # IPC handlers
│   │   ├── window.ts         # Window management
│   │   └── crawler/
│   │       ├── index.ts      # Crawler main logic
│   │       └── types.ts      # Crawler types
│   │
│   ├── renderer/
│   │   ├── index.tsx         # React entry point
│   │   ├── App.tsx           # Main App component
│   │   ├── components/
│   │   │   ├── Layout/
│   │   │   │   ├── Layout.tsx
│   │   │   │   └── Layout.css
│   │   │   ├── FolderTree/
│   │   │   │   ├── FolderTree.tsx
│   │   │   │   └── FolderTree.css
│   │   │   ├── ImageGrid/
│   │   │   │   ├── ImageGrid.tsx
│   │   │   │   └── ImageGrid.css
│   │   │   ├── Toolbar/
│   │   │   │   ├── Toolbar.tsx
│   │   │   │   └── Toolbar.css
│   │   │   └── StatusBar/
│   │   │       ├── StatusBar.tsx
│   │   │       └── StatusBar.css
│   │   ├── hooks/
│   │   │   ├── useLibrary.ts
│   │   │   └── useMenu.ts
│   │   ├── styles/
│   │   │   ├── index.css
│   │   │   └── variables.css
│   │   └── types/
│   │       └── index.ts
│   │
│   └── shared/
│       ├── types/
│       │   ├── library.ts    # Library data types
│       │   └── crawler.ts    # Crawler types
│       └── utils/
│           ├── paths.ts       # Path utilities
│           └── validation.ts # Data validation
│
├── public/
│   ├── index.html            # HTML template
│   └── icon.png              # App icon
│
├── library/                   # Image storage (created at runtime)
│
├── tests/
│   └── e2e/
│       └── basic.spec.ts
│
├── doc/                       # Documentation
│   ├── DEVELOPMENT_PLAN.md
│   └── DEVELOPMENT_PLAN_EN.md
│
├── package.json
├── tsconfig.json
├── webpack.config.js
├── .eslintrc.js
├── .prettierrc
└── .gitignore
```

#### 3.2 Basic React App structure

**src/renderer/App.tsx**:
```typescript
import React, { useState, useEffect } from 'react';
import Layout from './components/Layout/Layout';
import FolderTree from './components/FolderTree/FolderTree';
import ImageGrid from './components/ImageGrid/ImageGrid';
import Toolbar from './components/Toolbar/Toolbar';
import StatusBar from './components/StatusBar/StatusBar';
import { useLibrary } from './hooks/useLibrary';
import { useMenu } from './hooks/useMenu';
import './styles/index.css';

function App() {
  const [selectedWork, setSelectedWork] = useState<string | null>(null);
  const [viewMode, setViewMode] = useState<'grid' | 'list'>('grid');
  const { library, refreshLibrary } = useLibrary();

  useMenu({
    onNewDownload: () => console.log('New download'),
    onViewChange: setViewMode,
    onRefresh: refreshLibrary
  });

  return (
    <Layout>
      <Layout.Header>
        <Toolbar />
      </Layout.Header>

      <Layout.Main>
        <Layout.Sidebar>
          <FolderTree
            works={library}
            selectedWork={selectedWork}
            onSelect={setSelectedWork}
          />
        </Layout.Sidebar>

        <Layout.Content>
          <ImageGrid
            workId={selectedWork}
            viewMode={viewMode}
          />
        </Layout.Content>
      </Layout.Main>

      <Layout.Footer>
        <StatusBar selectedWork={selectedWork} />
      </Layout.Footer>
    </Layout>
  );
}

export default App;
```

#### 3.3 Package.json scripts configuration

```json
{
  "scripts": {
    "start": "concurrently \"npm run start:main\" \"npm run start:renderer\"",
    "start:main": "tsc -p tsconfig.main.json && electron .",
    "start:renderer": "webpack serve --config webpack.config.js",
    "build": "npm run build:main && npm run build:renderer",
    "build:main": "tsc -p tsconfig.main.json",
    "build:renderer": "webpack --config webpack.config.js",
    "dist": "electron-builder",
    "test": "playwright test"
  }
}
```

This detailed plan covers the first 3 steps of Phase 1, establishing a solid foundation for the image viewer application with Electron, React, and TypeScript properly configured and structured.