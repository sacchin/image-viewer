# 画像ビューアの細かな修正実装計画

## 要件
以下の細かな修正を実装する：
1. フォルダを表示するパネルに横スクロールバーを追加
2. ファイルを表示するパネルで、上下の矢印キーでファイルを選択できるようにする
3. フォルダを表示するパネルで、二層目以降も三角のアイコンでフォルダを辿れるようにする
4. 画像プレビューのズームアップとズームアウトは、マウスホイールでもできるようにする

## 実装計画

### 1. フォルダパネルに横スクロールバーを追加
**対象ファイル**: `src/renderer/components/FolderTree/FolderTree.css`

**変更内容**:
- `.folder-tree-content`に`overflow-x: auto`を追加
- `.folder-node-item`の`white-space: nowrap`設定を維持
- 横スクロールバーのスタイルを定義（縦スクロールバーと同様のスタイル）

### 2. ファイルパネルで矢印キーによる選択機能を実装
**対象ファイル**: `src/renderer/components/FileList/FileList.tsx`

**変更内容**:
- `useEffect`フックでキーボードイベントリスナーを追加
- 選択インデックスを管理するstate変数を追加
- 上下矢印キーで選択項目を移動する処理を実装
- Enterキーで選択したファイルを開く処理を追加
- `tabIndex`属性を追加してフォーカス可能にする

### 3. フォルダパネルで二層目以降も展開可能にする
**対象ファイル**:
- `src/main/ipc.ts`
- `src/renderer/components/FolderTree/FolderTree.tsx`

**変更内容**:

`ipc.ts`:
- `read-folder-tree`ハンドラーの`maxDepth`パラメータを無制限に変更（現在は3に制限）
- 必要に応じて遅延読み込みを実装

`FolderTree.tsx`:
- 子フォルダの動的読み込み機能を追加（パフォーマンス改善のため）

### 4. 画像プレビューでマウスホイールによるズーム機能
**対象ファイル**:
- `src/renderer/components/ImagePreview/ImagePreview.tsx`
- `src/renderer/components/ImagePreview/ImagePreview.css`

**変更内容**:
- 既存の`handleWheel`関数（95-102行）でCtrl/Cmdキーなしでズーム機能実装済み
- `e.preventDefault()`でホイールイベントのデフォルト動作を無効化
- CSSの`overflow: auto`を`overflow: hidden`に変更してスクロールを完全に無効化（48行目）
- 上下キーで違うファイルが選択されたときに、画像プレビューも更新する（FileList.tsx 57行目にonFileSelect追加）
- 画像プレビューにおいて、マウスホイールで上下のスクロールは行わないようにする（実装完了）

## 実装順序
1. 横スクロールバー追加（最も簡単）
2. マウスホイールズーム改善
3. 矢印キーナビゲーション
4. ネストフォルダ展開改善

## 実装状況

### 完了した項目
1. ✅ **上下キーで違うファイルが選択されたときに画像プレビューも更新する**
   - FileList.tsx 57行目: `onFileSelect(file)`を追加
   - useEffectの依存配列にonFileSelectを追加（76行目）

2. ✅ **画像プレビューでマウスホイールによる上下スクロールを無効化**
   - ImagePreview.tsx 96行目: `e.preventDefault()`で既に無効化済み
   - ImagePreview.css 48行目: `overflow: hidden`に変更してスクロールバーも非表示

### テスト結果
- 「should update image preview when navigating with arrow keys」テスト: ✅ 成功
- 「should not scroll vertically with mouse wheel on image preview」テスト: ✅ 成功
- Arrow Key Navigation関連の全5テスト: ✅ 全て成功
- Mouse Wheel Zoom関連の全6テスト: ✅ 全て成功

## 技術的考慮事項

### パフォーマンス
- フォルダツリーの深い階層を扱う場合、遅延読み込みを検討
- 大量のファイルがある場合の仮想スクロールの実装を検討

### ユーザビリティ
- キーボードナビゲーションのフォーカス管理
- スクロール位置の保持
- ズーム操作の感度調整

### アクセシビリティ
- キーボードのみでの操作完全対応
- スクリーンリーダー対応の考慮

## 画像プレビューのパン機能実装計画

### 現状の問題点
- ズーム時に画像は中央固定で拡大され、`overflow: hidden`により見えない部分が切れる
- 画像を移動する機能がないため、ズーム時に画像の一部しか見えない

### 実装内容
1. **状態管理の追加**
   - 画像の位置（x, y）を管理するstate追加
   - ドラッグ状態を管理するstate追加

2. **ドラッグ機能の実装**
   - マウスダウンでドラッグ開始
   - マウスムーブで画像を移動
   - マウスアップでドラッグ終了
   - カーソルを`grab`/`grabbing`に変更

3. **スクロール機能の追加（オプション）**
   - viewportに`overflow: auto`を設定
   - ズーム時にスクロールバーを表示

4. **ズーム時の位置リセット**
   - ズームイン/アウト時に位置を調整
   - フィット表示時に位置をリセット

### 技術的な実装詳細
- `useState`で`position: {x: 0, y: 0}`と`isDragging: boolean`を管理
- 画像に`transform: translate(${position.x}px, ${position.y}px) scale(${scale})`を適用
- マウスイベント（`onMouseDown`, `onMouseMove`, `onMouseUp`）でドラッグ処理
- ズーム倍率が1以上の時のみドラッグ可能に制限

この実装により、ズーム時に画像全体を確認できるようになります。